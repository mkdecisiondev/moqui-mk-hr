<?xml version="1.0" encoding="UTF-8"?>

<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-2.1.xsd">

    <service verb="create" noun="TimeEntryClockIn">
        <in-parameters>
            <!-- <parameter name="comments"/> -->
            <!-- <parameter name="partyId"/> -->
            <!-- <parameter name="timesheetId"/> -->
        </in-parameters>

        <out-parameters>
        </out-parameters>

        <actions>
            <!-- can be move to just call the service right away -->
            <log message="---------------hitting the service---------------------------"/>
            <set field="workTypeEnumId" value="WktpGeneralLabor"/>
            <service-call name="mantle.work.TimeServices.create#TimeEntryClockIn" in-map="context"/>
        </actions>
    </service>

<!-- creating new timeSheet -->
     <service verb="create" noun="TimeSheet">
        <in-parameters>
            <parameter name="partyId"/>
        </in-parameters>

        <actions>
            <log message="---------------hitting the service---------------------------"/>
            <set field="fromDate" from="ec.user.nowTimestamp"/>
            <set field="statusId" value="TmshInProcess"/>
            <service-call name="create#mantle.work.time.Timesheet" in-map="context"/>
        </actions>
    </service>

    <!-- creating break timeEntry -->
    <service verb="create" noun="breakStart">
        <in-parameters>
        </in-parameters>

        <out-parameters>
        </out-parameters>

        <actions>
            <!-- can be move to just call the service right away -->
            <log message="---------------hitting the service---------------------------"/>
            <log message="---------------${isAdmin}---------------------------"/>
            <set field="workTypeEnumId" value="WktpPaidBreak"/>
            <service-call name="mantle.work.TimeServices.create#TimeEntryClockIn" in-map="context"/>
        </actions>
    </service>

    <!-- updating the breaktime -->
    <service verb="store" noun="breakStop">
        <in-parameters>

        </in-parameters>

        <out-parameters>
        </out-parameters>

        <actions>
            <!-- can be move to just call the service right away -->
            <log message="---------------Stop time---------------------------"/>
            <service-call name="mantle.work.TimeServices.store#TimeEntry" in-map="context"/>
        </actions>
    </service>

    <!-- edit timeEntry -->
     <service verb="edit" noun="TimeEntry">
        <in-parameters>
            <parameter name="timeEntryId" required="true"/>
            <parameter name="fromDate"/>
            <parameter name="thruDate"/>
            <parameter name="comments"/>
            <parameter name="partyId"/>
            <parameter name="workTypeEnumId"/>
        </in-parameters>
        <out-parameters>
        </out-parameters>

        <actions>
            <if condition="thruDate &gt; fromDate">
                <script>
                    EntityValue queryForTimeEntry = ec.entity.find("mantle.work.time.TimeEntry").condition( [ "timeEntryId" : timeEntryId, "partyId" : partyId ] ).one()
                </script>
                <if condition="queryForTimeEntry">
                    <if condition="!fromDate">
                        <set field="fromDate" from="queryForTimeEntry.fromDate"/>
                    </if>
                    <if condition="!thruDate">
                        <set field="thruDate" from="queryForTimeEntry.thruDate"/>
                    </if>
                    <if condition="!workTypeEnumId">
                        <set field="workTypeEnumId" from="queryForTimeEntry.workTypeEnumId"/>
                    </if>
                    <service-call name="mantle.work.TimeServices.delete#TimeEntry" in-map="context" out-map="context"/>
                    <service-call name="mantle.work.TimeServices.store#TimeEntry" in-map="context" out-map="context"/>
                    <else><message type="warning">That time entry does not exist for you.</message></else>
                </if>
                <else>
                    <message>Clock-out time should be later than clock-in time</message>
                </else>
            </if>
        </actions>
    </service>

    <!-- calculating time -->
    <service verb="calculate" noun="SumOfHours" type="java" location="com.mk.moqui.TimeAndAttendanceServices" method="calculateSumOfHours">
        <in-parameters>
            <parameter name="timeEntryList" type="List"/>
            <parameter name="week" default-value="6"/>
            <parameter name="day" default-value="MONDAY"/>

        </in-parameters>
        <actions>
            <log message="---------------${ec.user.nowTimestamp}---------------------------"/>
        </actions>

    </service>

     <!-- calculating overtime -->
    <service verb="calculate" noun="SumOfOverTime" type="java" location="com.mk.moqui.TimeAndAttendanceServices" method="calculateSumOfHours">
        <in-parameters>
            <parameter name="timeEntryList" type="List"/>
            <parameter name="week" default-value="1"/>
            <parameter name="day"/>
            <parameter name="overTime" default-value="true"/>

        </in-parameters>
    </service>
    

</services>