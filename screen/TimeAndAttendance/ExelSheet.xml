<?xml version="1.0" encoding="UTF-8"?>

<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        require-authentication="anonymous-all" >
        <!-- parameters from the previous page -->
    <parameter name="partyId" required="true"/>
    <parameter name="timesheetId" required="true"/>

    <transition name="editTimeEntry"><service-call name="TimeAndAttendanceServices.edit#TimeEntry" in-map="context"/>
        <default-response url="../TimeSheet" in-map="context"/></transition>

    <actions>
        <entity-find entity-name="mantle.work.time.TimeEntry" list="timeEntryList">
            <search-form-inputs default-order-by="-fromDate"/>
            <econdition field-name="workTypeEnumId" value="WktpGeneralLabor"/>
            <econdition field-name="partyId"/>
        </entity-find>
    </actions>


    <widgets>
        <label type="h1" text="${timesheetId}"/>
       <form-list name="PersonalReport" list="timeEntryList" skip-form="true" header-dialog="true" saved-finds="true">

            <field name="timeEntryId"><default-field title="ID (Click to Edit Entry)"><container-dialog id="EditTimeDialog" button-text="${timeEntryId}">
                    <form-single name="EditTimeForm" transition="editTimeEntry">
                        <field name="partyId"><default-field><hidden/></default-field></field>
                        <field name="timeEntryId"><default-field title="Time Entry ID"><hidden/></default-field></field>
                        <field name="fromDate"><default-field title="Clock-In Time"><date-time/></default-field></field>
                        <field name="thruDate"><default-field title="Clock-Out Time"><date-time/></default-field></field>
                        <field name="comments"><default-field><text-area cols="60" rows="3"/></default-field></field>
                        <field name="submitButton"><default-field title="Edit Time Entry"><submit/></default-field></field>
                    </form-single>
                </container-dialog></default-field></field>

            <!-- partyId -->
            <field name="partyId">
                <default-field title="Party ID">
                    <display/>
                </default-field>
            </field>

            <field name="timesheetId">
                <default-field title="Timesheet ID">
                    <display/>
                </default-field>
            </field>

            <!-- testonly -->
            <field name="workTypeEnumId">
                <default-field title="Work Status">
                    <display/>
                </default-field>
            </field>

            <!-- setup the person first and last name base on row partyId -->
            <row-actions>
                <entity-find-one entity-name="mantle.party.Person" value-field="person">
                    <field-map field-name="partyId" operator="equals" from="partyId"/>
                    <select-field field-name="firstName, lastName"/>
                </entity-find-one>
            </row-actions>

            <!-- firstName -->
            <field name="firstName" from="person?.firstName">
                <default-field title="First Name">
                    <display />
                </default-field>
            </field>


            <!-- lastName -->
            <field name="lastName" from="person?.lastName">
                <default-field title="Last Name">
                    <display />
                </default-field>
            </field>

            <field name="fromDate">
                <header-field show-order-by="true">
                    <date-period allow-empty="true"/>
                </header-field>
                <default-field title="Clock-In Time">
                    <display format="MM-dd-yy / hh:mm a / E "/>
                </default-field>
            </field>

            <field name="thruDate">
                <header-field show-order-by="true">
                    <date-period allow-empty="true"/>
                </header-field>
                <default-field title="Clock-Out Time">
                    <display format="MM-dd-yy / hh:mm a / E "/>
                </default-field>
            </field>

            <field name="hours"><header-field show-order-by="true"/>
                <default-field><display format="0.00"/></default-field></field>

            <field name="comments"><default-field><display/></default-field></field>

        </form-list>
    </widgets>
</screen>
